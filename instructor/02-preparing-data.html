<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Ny udgave af text mining på engelsk: Tidytext, stopwords, and sentiment analysis</title><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" type="text/css" href="../assets/styles.css"><script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="manifest" href="../site.webmanifest"><link rel="mask-icon" href="../safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"></head><body>
    <header id="top" class="navbar navbar-expand-md navbar-light bg-white top-nav library"><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-6">
      <div class="large-logo">
        <img alt="Library Carpentry" src="../assets/images/library-logo.svg"><abbr class="badge badge-light" title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught." style="background-color: #FF4955; border-radius: 5px">
          <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link" style="color: #000">
            <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
            Pre-Alpha
          </a>
          <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
        </abbr>
        
      </div>
    </div>
    <div class="selector-container">
      
      
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='../02-preparing-data.html';">Learner View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl navbar-light bg-white bottom-nav library" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Library Carpentry" src="../assets/images/library-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Ny udgave af text mining på engelsk
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Ny udgave af text mining på engelsk
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><hr><li><a class="dropdown-item" href="Gettingdata.html">How did we get the data?</a></li><li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a class="btn btn-primary" href="../aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Ny udgave af text mining på engelsk
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 0%" class="percentage">
    0%
  </div>
  <div class="progress library">
    <div class="progress-bar library" role="progressbar" style="width: 0%" aria-valuenow="0" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../02-preparing-data.html">Learner View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->
      
            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="00-introduction.html">1. Introduction</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="01-getting-ready.html">2. Loading data</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        3. Tidytext, stopwords, and sentiment analysis
        </span>
      </button>
    </div><!--/div.accordion-header-->
        
    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#loading-our-libraries-and-reading-our-data">Loading our libraries and reading our data</a></li>
<li><a href="#understanding-our-data">Understanding our data</a></li>
<li><a href="#introduction-to-tidytext-and-tokenization">Introduction to tidytext and tokenization</a></li>
<li><a href="#stopwords">Stopwords</a></li>
<li><a href="#sentiment-analysis">Sentiment analysis</a></li>
<li><a href="#bringing-it-all-together-joins">Bringing it all together: joins</a></li>
<li><a href="#analyzing-the-sentiment-of-parties">Analyzing the sentiment of parties</a></li>
<li><a href="#analyzing-the-sentiment-of-r%C3%B8d-and-bl%C3%A5-blok">Analyzing the sentiment of rød and blå blok</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="03-frequency-analysis.html">4. Word frequency analysis</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="04-sentiment.html">5. Text mining extras</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="05-stemming-and-more.html">6. frekvensanalyse</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="06-whats-next.html">7. whats_next</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      <hr><li><a class="dropdown-item" href="Gettingdata.html">How did we get the data?</a></li><li><a class="dropdown-item" href="reference.html">Reference</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width resources"><a href="../instructor/aio.html">See all in one page</a>
            

            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">
            
            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/01-getting-ready.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/03-frequency-analysis.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/01-getting-ready.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Loading data
        </a>
        <a class="chapter-link float-end" href="../instructor/03-frequency-analysis.html" rel="next">
          Next: Word frequency... 
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Tidytext, stopwords, and sentiment analysis</h1>
        <p>Last updated on 2024-05-29 |
        
        <a href="https://github.com/KUBDatalab/R-textmining_new/edit/main/episodes/02-preparing-data.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
        
        
        
        <p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 0 minutes</p>
        
        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>“How do we prepare text for analysis and measure the sentiment of
the text?”</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>“Using specific packages to perform text preparation and sentiment
analysis”</li>
</ul></div>
</div>
</div>
</div>
</div>
<section id="loading-our-libraries-and-reading-our-data"><h2 class="section-heading">Loading our libraries and reading our data<a class="anchor" aria-label="anchor" href="#loading-our-libraries-and-reading-our-data"></a>
</h2>
<hr class="half-width"><p>Let us now load our libraries</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">tidytext</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">tm</span><span class="op">)</span></span></code></pre>
</div>
</section><section id="understanding-our-data"><h2 class="section-heading">Understanding our data<a class="anchor" aria-label="anchor" href="#understanding-our-data"></a>
</h2>
<hr class="half-width"><p>We have now successfully loaded in our dataset. Before we start
preparing it for analysis, let us inspect the columns to see what the
dataset contains</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">kina</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 6 × 19
  ID            Date       `Start time` `End time`  Time `Agenda item` `Case no`
  &lt;chr&gt;         &lt;date&gt;     &lt;time&gt;       &lt;time&gt;     &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;
1 201001121437… 2010-01-12 14:37:05     14:37:25      20 2010-01-12-7         61
2 201001121437… 2010-01-12 14:37:25     14:47:59     634 2010-01-12-7         61
3 201001121447… 2010-01-12 14:47:59     14:48:05       6 2010-01-12-7         61
4 201001121448… 2010-01-12 14:48:05     14:49:01      56 2010-01-12-7         61
5 201001121449… 2010-01-12 14:49:01     14:49:03       2 2010-01-12-7         61
6 201001121449… 2010-01-12 14:49:03     14:49:47      44 2010-01-12-7         61
# ℹ 12 more variables: `Case type` &lt;chr&gt;, `Agenda title` &lt;chr&gt;,
#   `Subject 1` &lt;chr&gt;, `Subject 2` &lt;chr&gt;, Name &lt;chr&gt;, Gender &lt;chr&gt;,
#   Party &lt;chr&gt;, Role &lt;chr&gt;, Title &lt;chr&gt;, Birth &lt;date&gt;, Age &lt;dbl&gt;, Text &lt;chr&gt;</code></pre>
</div>
<p>We see that we have a lot of metadata, including the date of the
speech, the start and end time of the speech, the discussed
resolutions/law proposals and their classifications into subjects, as
well as various personal information about the speaker. The last column
is called <code>Text</code> and this contains the speech itself</p>
</section><section id="introduction-to-tidytext-and-tokenization"><h2 class="section-heading">Introduction to tidytext and tokenization<a class="anchor" aria-label="anchor" href="#introduction-to-tidytext-and-tokenization"></a>
</h2>
<hr class="half-width"><p>To analyze the speeches we need to make the text tidy. Tidy text
refers to a dataset where each text has been split up into the
individual words that make up the speech, and in format where each row
contains one word. <img src="../fig/Tidy_text.png" alt="Tidy text example" class="figure"></p>
<p>Splitting texts, in our case speeches, into individual words is
called tokenization <img src="../fig/Tokenization.png" alt="Tokenization of example sentence" class="figure"> Hvitfeldt &amp; Silge,
2021</p>
<p>Tokenization of text into individual words is necessary for text
mining because it allows us to analyze the text closely and in detail,
analyses which can later be visualized to understand the patterns of the
text. Tokenization is language independent, as long as the language is
written in an alphabet or syllabary that uses spaces between words. When
tokenizing our text to make it tidy, the metadata that describe the
whole speech are carried over to also describe the individual word. Thus
we can split the text into individual words but still keep track of who
said that word and when they did.</p>
<p>We use the tidytext library for tokenization</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kina_tidy</span> <span class="op">&lt;-</span> <span class="va">kina</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">unnest_tokens</span><span class="op">(</span><span class="va">word</span>, <span class="va">Text</span><span class="op">)</span> <span class="co">#tidytext tokenization</span></span></code></pre>
</div>
</section><section id="stopwords"><h2 class="section-heading">Stopwords<a class="anchor" aria-label="anchor" href="#stopwords"></a>
</h2>
<hr class="half-width"><p>In all natural language texts, frequent words that carry little
meaning by themselves are distributed all across the text <img src="../fig/Stopwords.png" alt="”Stopwords examples" class="figure"></p>
<p>The frequent low-meaning words need to be removed because they do not
add anything to our understanding of the texts and are just noise</p>
<p>The tm library contains a list of stopwords for Danish, which we’ll
make into a tibble. We have to specify that the list of stopwords that
we want to call is the list for the Danish language. Note that stopword
lists are also available for most major European languages</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stopwords_dansk</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>word <span class="op">=</span> <span class="fu">stopwords</span><span class="op">(</span>kind <span class="op">=</span> <span class="st">"danish"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
</section><section id="sentiment-analysis"><h2 class="section-heading">Sentiment analysis<a class="anchor" aria-label="anchor" href="#sentiment-analysis"></a>
</h2>
<hr class="half-width"><p>Sentiment analysis is a method for measuring the sentiment of a text.
To do this, it is necessary to have a list of words that have been
assigned to a certain sentiment. This can be a simple assignation of
words into positive and negative, it can be an assignation to one among
a multitude of categories, and the word can have a value on a scale. In
this course we will use the AFINN index for Danish, which assigns
approximately 3500 words on a scale from +5 to -5. This will enable us
to calculate and compare the overall sentiment of the various speeches.
As a side note, AFINN index is also available in English.</p>
<p>We need to download the AFINN Index from GitHub</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">download.file</span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/KUBDatalab/R-textmining/main/data/AFINN_dansk.csv"</span>, <span class="st">"data/AFINN_dansk.csv"</span>, mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span></span></code></pre>
</div>
<p>Now we read need to read the AFINN Index into a tibble and rename the
columns</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">AFINN_dansk</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/AFINN_dansk.csv"</span><span class="op">)</span></span></code></pre>
</div>
</section><section id="bringing-it-all-together-joins"><h2 class="section-heading">Bringing it all together: joins<a class="anchor" aria-label="anchor" href="#bringing-it-all-together-joins"></a>
</h2>
<hr class="half-width"><p>We have now created tibbles, each with the words appropriate for
removal of stopwords and application of sentiment analysis respectively.
Now we need to bring them together in the correct order, and we do this
by using join-functions. The join functions from the tidyverse library
allow tibbles to be joined together based on columns that have cells
where the content is the same in both tibbles.</p>
<p>There are fundamentally 2 types of joins: * Mutating joins (which add
columns) * Filtering joins (which filter away rows)</p>
<p>Mutating joins work by adding new columns to the tibble. We will use
left_join, which is the most common of the mutating joins <img src="../fig/Venn_left_join.jpg" alt="”left_join AFINN Index with tidy text" class="figure"> The left_join joins all
AFINN sentiment values to those rows that contain a word that is in the
AFINN Index and adds it as a new column to the tibble. In the new
column, the rows that contain words that don’t appear in the AFINN Index
have NA in their cell</p>
<p>Filtering joins work by filtering away some rows in the tibble. We
will use the anti_join, which removes those rows that contain a word
that is also in the stopword list <img src="../fig/Venn_anti_join.jpg" alt="”anti_join stopwords with tidy text" class="figure"></p>
<p>For more info on joins see <a href="https://r4ds.had.co.nz/relational-data.html" class="external-link">R for Data Science
section section 13: Relational data</a></p>
<p>We will use the anti_join first, beause we need to filter away
stopwords before we analyse the text with sentiment analysis</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kina_tidy_2</span> <span class="op">&lt;-</span> <span class="va">kina_tidy</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">anti_join</span><span class="op">(</span><span class="va">stopwords_dansk</span>, by <span class="op">=</span> <span class="st">"word"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#stopwords in Danish</span></span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">AFINN_dansk</span>, by <span class="op">=</span> <span class="st">"word"</span><span class="op">)</span> <span class="co">#left join with AFINN Index in Danish</span></span></code></pre>
</div>
</section><section id="analyzing-the-sentiment-of-parties"><h2 class="section-heading">Analyzing the sentiment of parties<a class="anchor" aria-label="anchor" href="#analyzing-the-sentiment-of-parties"></a>
</h2>
<hr class="half-width"><p>We would like to measure the sentiment of each party when giving
speeches on the topic of China</p>
<p>First we need to calculate the mean sentiment value for each party.
We save it as an object so that we can easily recall it for
visualization</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kina_sentiment_value</span> <span class="op">&lt;-</span> <span class="va">kina_tidy_2</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">Role</span> <span class="op">!=</span> <span class="st">"formand"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">Party</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarize</span><span class="op">(</span></span>
<span>    mean_sentiment_value <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">sentiment_value</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<p>Now we want to visualize each party’s mean sentiment value according
to the AFINN-Index</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kina_sentiment_value</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Party</span>, y <span class="op">=</span> <span class="va">mean_sentiment_value</span>, fill <span class="op">=</span> <span class="va">Party</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span> <span class="st">"Party"</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/02-preparing-data-rendered-unnamed-chunk-11-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></section><section id="analyzing-the-sentiment-of-rød-and-blå-blok"><h2 class="section-heading">Analyzing the sentiment of rød and blå blok<a class="anchor" aria-label="anchor" href="#analyzing-the-sentiment-of-r%C3%B8d-and-bl%C3%A5-blok"></a>
</h2>
<hr class="half-width"><p>We would also like to analyze the sentiment of rød and blå blok as a
whole respectively. To do this, we need to add a column to each row that
specifies whether the word comes from a member of a party in rød blok or
blå blok. We must therefore first define which parties make up rød and
blå blok and put that in a tibble, then bind the two tibbles into one
tibble, and then make a left_join to the rows in our tidy text</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">roed_blok</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>Party <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"ALT"</span>, <span class="st">"EL"</span>, <span class="st">"SF"</span>, <span class="st">"S"</span>, <span class="st">"RV"</span><span class="op">)</span>, Blok <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"roed_blok"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">blaa_blok</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>Party <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"V"</span>, <span class="st">"KF"</span>, <span class="st">"LA"</span>, <span class="st">"DF"</span><span class="op">)</span>, Blok <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"blaa_blok"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">blok</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span><span class="va">roed_blok</span>, <span class="va">blaa_blok</span><span class="op">)</span></span>
<span><span class="va">kina_tidy_blokke</span> <span class="op">&lt;-</span> <span class="va">kina_sentiment_value</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">blok</span>, by <span class="op">=</span> <span class="st">"Party"</span><span class="op">)</span></span></code></pre>
</div>
<p>Now we would like to do the same analysis of mean sentiment value,
this time for each blok. We also want to specify that the column for
roed_bloek should be red and the column for blaa_blok should be blue</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kina_blokke_sentiment_value</span> <span class="op">&lt;-</span> <span class="va">kina_tidy_blokke</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">Blok</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarize</span><span class="op">(</span></span>
<span>    mean_sentiment_value <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">mean_sentiment_value</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kina_blokke_sentiment_value</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Blok</span>, y <span class="op">=</span> <span class="va">mean_sentiment_value</span>, fill <span class="op">=</span> <span class="va">Blok</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"red"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span> <span class="st">"Blok"</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/02-preparing-data-rendered-unnamed-chunk-14-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul><li>“All natural language texts must be prepared for analysis”</li>
</ul></div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/01-getting-ready.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/03-frequency-analysis.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/01-getting-ready.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Loading data
        </a>
        <a class="chapter-link float-end" href="../instructor/03-frequency-analysis.html" rel="next">
          Next: Word frequency... 
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>
        
        <a href="https://github.com/KUBDatalab/R-textmining_new/edit/main/episodes/02-preparing-data.Rmd" class="external-link">Edit on GitHub</a>
        
	
        | <a href="https://github.com/KUBDatalab/R-textmining_new/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/KUBDatalab/R-textmining_new/" class="external-link">Source</a></p>
				<p><a href="https://github.com/KUBDatalab/R-textmining_new/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:kubdatalab@kb.dk">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">
        
        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>
        
        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.4" class="external-link">sandpaper (0.16.4)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.5" class="external-link">pegboard (0.7.5)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.2" class="external-link">varnish (1.0.2)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://KUBDatalab.github.io/R-textmining_new/instructor/02-preparing-data.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "Tidytext, stopwords, and sentiment analysis",
  "creativeWorkStatus": "active",
  "url": "https://KUBDatalab.github.io/R-textmining_new/instructor/02-preparing-data.html",
  "identifier": "https://KUBDatalab.github.io/R-textmining_new/instructor/02-preparing-data.html",
  "dateCreated": "2024-05-01",
  "dateModified": "2024-05-29",
  "datePublished": "2024-05-29"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo
    2022-11-07: we have gotten a notification that we have an overage for our
    tracking and I'm pretty sure this has to do with Workbench usage.
    Considering that I am not _currently_ using this tracking because I do not
    yet know how to access the data, I am turning this off for now.
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
    _paq.push(["setDomains", ["*.preview.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
    _paq.push(["setDoNotTrack", true]);
    _paq.push(["disableCookies"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
          var u="https://carpentries.matomo.cloud/";
          _paq.push(['setTrackerUrl', u+'matomo.php']);
          _paq.push(['setSiteId', '1']);
          var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
          g.async=true; g.src='https://cdn.matomo.cloud/carpentries.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
  </script>
  End Matomo Code --></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

